---
export const prerender = true;

import path from "node:path";
import { getSortedPosts } from "../../utils/content-utils";
import PostLayout from "../../layouts/PostLayout.astro";
import { formatDateToYYYYMMDD } from "../../utils/date-utils";

export async function getStaticPaths() {
	const blogEntries = await getSortedPosts();
	return blogEntries.map((entry) => ({
		params: { slug: entry.slug },
		props: { entry },
	}));
}

const { entry } = Astro.props;
const { Content, remarkPluginFrontmatter } = await entry.render();

// 处理最后更新时间
const lastModified = remarkPluginFrontmatter.lastModified 
    ? new Date(remarkPluginFrontmatter.lastModified) 
    : entry.data.published;
---

<PostLayout
	title={entry.data.title}
	published={entry.data.published}
    lastModified={lastModified}
	description={entry.data.description}
	image={entry.data.image}
	tags={entry.data.tags}
	category={entry.data.category}
    prevSlug={entry.data.prevSlug}
    prevTitle={entry.data.prevTitle}
    nextSlug={entry.data.nextSlug}
    nextTitle={entry.data.nextTitle}
>
	<Content />
</PostLayout>